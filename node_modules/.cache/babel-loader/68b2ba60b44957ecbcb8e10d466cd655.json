{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar resolvePermission = exports.resolvePermission = function resolvePermission(_ref) {\n  var permissions = _ref.permissions,\n      record = _ref.record,\n      resource = _ref.resource;\n  return function (mapping) {\n    if (typeof mapping.resolve === 'function') {\n      var result = mapping.resolve({\n        record: record,\n        resource: resource,\n        permissions: permissions,\n        exact: mapping.exact,\n        value: mapping.permissions\n      });\n\n      if (typeof result.then === 'function') {\n        return result.then(function (matched) {\n          return {\n            matched: matched,\n            view: mapping.view\n          };\n        });\n      }\n\n      return Promise.resolve({\n        matched: result,\n        view: mapping.view\n      });\n    }\n\n    if (Array.isArray(mapping.permissions) && Array.isArray(permissions)) {\n      if (mapping.exact) {\n        return Promise.resolve({\n          matched: mapping.permissions.every(function (mp) {\n            return permissions.includes(mp);\n          }),\n          view: mapping.view\n        });\n      }\n\n      return Promise.resolve({\n        matched: mapping.permissions.some(function (mp) {\n          return permissions.includes(mp);\n        }),\n        view: mapping.view\n      });\n    }\n\n    if (Array.isArray(mapping.permissions)) {\n      return Promise.resolve({\n        matched: mapping.permissions.includes(permissions),\n        view: mapping.view\n      });\n    }\n\n    if (Array.isArray(permissions)) {\n      return Promise.resolve({\n        matched: permissions.includes(mapping.permissions),\n        view: mapping.view\n      });\n    }\n\n    return Promise.resolve({\n      matched: mapping.permissions === permissions,\n      view: mapping.view\n    });\n  };\n};\n\nexports.default = function (_ref2) {\n  var mappings = _ref2.mappings,\n      permissions = _ref2.permissions,\n      record = _ref2.record,\n      resource = _ref2.resource;\n  var promise = resolvePermission({\n    permissions: permissions,\n    record: record,\n    resource: resource\n  });\n  return Promise.all(mappings.map(promise)).then(function (matchers) {\n    return matchers.find(function (match) {\n      return match.matched;\n    });\n  });\n};","map":{"version":3,"sources":["C:/Users/m2bab/VM/rd2/frontend/node_modules/admin-on-rest/lib/auth/resolvePermissions.js"],"names":["Object","defineProperty","exports","value","resolvePermission","_ref","permissions","record","resource","mapping","resolve","result","exact","then","matched","view","Promise","Array","isArray","every","mp","includes","some","default","_ref2","mappings","promise","all","map","matchers","find","match"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar resolvePermission = exports.resolvePermission = function resolvePermission(_ref) {\n    var permissions = _ref.permissions,\n        record = _ref.record,\n        resource = _ref.resource;\n    return function (mapping) {\n        if (typeof mapping.resolve === 'function') {\n            var result = mapping.resolve({\n                record: record,\n                resource: resource,\n                permissions: permissions,\n                exact: mapping.exact,\n                value: mapping.permissions\n            });\n\n            if (typeof result.then === 'function') {\n                return result.then(function (matched) {\n                    return { matched: matched, view: mapping.view };\n                });\n            }\n\n            return Promise.resolve({ matched: result, view: mapping.view });\n        }\n\n        if (Array.isArray(mapping.permissions) && Array.isArray(permissions)) {\n            if (mapping.exact) {\n                return Promise.resolve({\n                    matched: mapping.permissions.every(function (mp) {\n                        return permissions.includes(mp);\n                    }),\n                    view: mapping.view\n                });\n            }\n\n            return Promise.resolve({\n                matched: mapping.permissions.some(function (mp) {\n                    return permissions.includes(mp);\n                }),\n                view: mapping.view\n            });\n        }\n\n        if (Array.isArray(mapping.permissions)) {\n            return Promise.resolve({\n                matched: mapping.permissions.includes(permissions),\n                view: mapping.view\n            });\n        }\n\n        if (Array.isArray(permissions)) {\n            return Promise.resolve({\n                matched: permissions.includes(mapping.permissions),\n                view: mapping.view\n            });\n        }\n\n        return Promise.resolve({\n            matched: mapping.permissions === permissions,\n            view: mapping.view\n        });\n    };\n};\n\nexports.default = function (_ref2) {\n    var mappings = _ref2.mappings,\n        permissions = _ref2.permissions,\n        record = _ref2.record,\n        resource = _ref2.resource;\n\n    var promise = resolvePermission({ permissions: permissions, record: record, resource: resource });\n    return Promise.all(mappings.map(promise)).then(function (matchers) {\n        return matchers.find(function (match) {\n            return match.matched;\n        });\n    });\n};"]},"metadata":{},"sourceType":"script"}