{"ast":null,"code":"const {\n  hp2Builder\n} = require('@selderee/plugin-htmlparser2');\n\nconst merge = require('deepmerge');\n\nconst he = require('he');\n\nconst htmlparser = require('htmlparser2');\n\nconst selderee = require('selderee');\n\nconst {\n  BlockTextBuilder\n} = require('./block-text-builder');\n\nconst defaultFormatters = require('./formatter');\n\nconst {\n  limitedDepthRecursive,\n  mergeDuplicatesPreferLast,\n  set\n} = require('./helper'); // eslint-disable-next-line import/no-unassigned-import\n\n\nrequire('./typedefs');\n/**\n * Default options.\n *\n * @constant\n * @type { Options }\n * @default\n * @private\n */\n\n\nconst DEFAULT_OPTIONS = {\n  baseElements: {\n    selectors: ['body'],\n    orderBy: 'selectors',\n    // 'selectors' | 'occurrence'\n    returnDomByDefault: true\n  },\n  decodeOptions: {\n    isAttributeValue: false,\n    strict: false\n  },\n  formatters: {},\n  limits: {\n    ellipsis: '...',\n    maxBaseElements: undefined,\n    maxChildNodes: undefined,\n    maxDepth: undefined,\n    maxInputLength: 1 << 24 // 16_777_216\n\n  },\n  longWordSplit: {\n    forceWrapOnLimit: false,\n    wrapCharacters: []\n  },\n  preserveNewlines: false,\n  selectors: [{\n    selector: '*',\n    format: 'inline'\n  }, {\n    selector: 'a',\n    format: 'anchor',\n    options: {\n      baseUrl: null,\n      hideLinkHrefIfSameAsText: false,\n      ignoreHref: false,\n      noAnchorUrl: true,\n      noLinkBrackets: false\n    }\n  }, {\n    selector: 'article',\n    format: 'block'\n  }, {\n    selector: 'aside',\n    format: 'block'\n  }, {\n    selector: 'blockquote',\n    format: 'blockquote',\n    options: {\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2,\n      trimEmptyLines: true\n    }\n  }, {\n    selector: 'br',\n    format: 'lineBreak'\n  }, {\n    selector: 'div',\n    format: 'block'\n  }, {\n    selector: 'footer',\n    format: 'block'\n  }, {\n    selector: 'form',\n    format: 'block'\n  }, {\n    selector: 'h1',\n    format: 'heading',\n    options: {\n      leadingLineBreaks: 3,\n      trailingLineBreaks: 2,\n      uppercase: true\n    }\n  }, {\n    selector: 'h2',\n    format: 'heading',\n    options: {\n      leadingLineBreaks: 3,\n      trailingLineBreaks: 2,\n      uppercase: true\n    }\n  }, {\n    selector: 'h3',\n    format: 'heading',\n    options: {\n      leadingLineBreaks: 3,\n      trailingLineBreaks: 2,\n      uppercase: true\n    }\n  }, {\n    selector: 'h4',\n    format: 'heading',\n    options: {\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2,\n      uppercase: true\n    }\n  }, {\n    selector: 'h5',\n    format: 'heading',\n    options: {\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2,\n      uppercase: true\n    }\n  }, {\n    selector: 'h6',\n    format: 'heading',\n    options: {\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2,\n      uppercase: true\n    }\n  }, {\n    selector: 'header',\n    format: 'block'\n  }, {\n    selector: 'hr',\n    format: 'horizontalLine',\n    options: {\n      leadingLineBreaks: 2,\n      length: undefined,\n      trailingLineBreaks: 2\n    }\n  }, {\n    selector: 'img',\n    format: 'image',\n    options: {\n      baseUrl: null\n    }\n  }, {\n    selector: 'main',\n    format: 'block'\n  }, {\n    selector: 'nav',\n    format: 'block'\n  }, {\n    selector: 'ol',\n    format: 'orderedList',\n    options: {\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2\n    }\n  }, {\n    selector: 'p',\n    format: 'paragraph',\n    options: {\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2\n    }\n  }, {\n    selector: 'pre',\n    format: 'pre',\n    options: {\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2\n    }\n  }, {\n    selector: 'section',\n    format: 'block'\n  }, {\n    selector: 'table',\n    format: 'table',\n    options: {\n      colSpacing: 3,\n      leadingLineBreaks: 2,\n      maxColumnWidth: 60,\n      rowSpacing: 0,\n      trailingLineBreaks: 2,\n      uppercaseHeaderCells: true\n    }\n  }, {\n    selector: 'ul',\n    format: 'unorderedList',\n    options: {\n      itemPrefix: ' * ',\n      leadingLineBreaks: 2,\n      trailingLineBreaks: 2\n    }\n  }, {\n    selector: 'wbr',\n    format: 'wbr'\n  }],\n  tables: [],\n  // deprecated\n  whitespaceCharacters: ' \\t\\r\\n\\f\\u200b',\n  wordwrap: 80\n};\n\nconst concatMerge = (acc, src, options) => [...acc, ...src];\n\nconst overwriteMerge = (acc, src, options) => [...src];\n\nconst selectorsMerge = (acc, src, options) => acc.some(s => typeof s === 'object') ? concatMerge(acc, src, options) // selectors\n: overwriteMerge(acc, src, options) // baseElements.selectors\n;\n/**\n * Preprocess options, compile selectors into a decision tree,\n * return a function intended for batch processing.\n *\n * @param   { Options } [options = {}]   HtmlToText options.\n * @returns { (html: string) => string } Pre-configured converter function.\n * @static\n */\n\n\nfunction compile(options = {}) {\n  options = merge(DEFAULT_OPTIONS, options, {\n    arrayMerge: overwriteMerge,\n    customMerge: key => key === 'selectors' ? selectorsMerge : undefined\n  });\n  options.formatters = Object.assign({}, defaultFormatters, options.formatters);\n  handleDeprecatedOptions(options);\n  const uniqueSelectors = mergeDuplicatesPreferLast(options.selectors, s => s.selector);\n  const selectorsWithoutFormat = uniqueSelectors.filter(s => !s.format);\n\n  if (selectorsWithoutFormat.length) {\n    throw new Error('Following selectors have no specified format: ' + selectorsWithoutFormat.map(s => `\\`${s.selector}\\``).join(', '));\n  }\n\n  const picker = new selderee.DecisionTree(uniqueSelectors.map(s => [s.selector, s])).build(hp2Builder);\n  const baseSelectorsPicker = new selderee.DecisionTree(options.baseElements.selectors.map((s, i) => [s, i + 1])).build(hp2Builder);\n\n  function findBaseElements(dom) {\n    return findBases(dom, options, baseSelectorsPicker);\n  }\n\n  const limitedWalk = limitedDepthRecursive(options.limits.maxDepth, recursiveWalk, function (dom, builder) {\n    builder.addInline(options.limits.ellipsis || '');\n  });\n  return function (html) {\n    return process(html, options, picker, findBaseElements, limitedWalk);\n  };\n}\n/**\n * Convert given HTML according to preprocessed options.\n *\n * @param { string } html HTML content to convert.\n * @param { Options } options HtmlToText options (preprocessed).\n * @param { Picker<DomNode, TagDefinition> } picker\n * Tag definition picker for DOM nodes processing.\n * @param { (dom: DomNode[]) => DomNode[] } findBaseElements\n * Function to extract elements from HTML DOM\n * that will only be present in the output text.\n * @param { RecursiveCallback } walk Recursive callback.\n * @returns { string }\n */\n\n\nfunction process(html, options, picker, findBaseElements, walk) {\n  const maxInputLength = options.limits.maxInputLength;\n\n  if (maxInputLength && html && html.length > maxInputLength) {\n    console.warn(`Input length ${html.length} is above allowed limit of ${maxInputLength}. Truncating without ellipsis.`);\n    html = html.substring(0, maxInputLength);\n  }\n\n  const handler = new htmlparser.DomHandler();\n  new htmlparser.Parser(handler, {\n    decodeEntities: false\n  }).parseComplete(html);\n  const bases = findBaseElements(handler.dom);\n  const builder = new BlockTextBuilder(options, picker);\n  walk(bases, builder);\n  return builder.toString();\n}\n/**\n * Convert given HTML content to plain text string.\n *\n * @param   { string }  html           HTML content to convert.\n * @param   { Options } [options = {}] HtmlToText options.\n * @returns { string }                 Plain text string.\n * @static\n *\n * @example\n * const { convert } = require('html-to-text');\n * const text = convert('<h1>Hello World</h1>', {\n *   wordwrap: 130\n * });\n * console.log(text); // HELLO WORLD\n */\n\n\nfunction convert(html, options = {}) {\n  return compile(options)(html);\n}\n/**\n * Map previously existing and now deprecated options to the new options layout.\n * This is a subject for cleanup in major releases.\n *\n * @param { Options } options HtmlToText options.\n */\n\n\nfunction handleDeprecatedOptions(options) {\n  const selectorDefinitions = options.selectors;\n\n  if (options.tags) {\n    const tagDefinitions = Object.entries(options.tags).map(([selector, definition]) => ({ ...definition,\n      selector: selector || '*'\n    }));\n    selectorDefinitions.push(...tagDefinitions);\n  }\n\n  function copyFormatterOption(source, format, target) {\n    if (options[source] === undefined) {\n      return;\n    }\n\n    for (const definition of selectorDefinitions) {\n      if (definition.format === format) {\n        set(definition, ['options', target], options[source]);\n      }\n    }\n  }\n\n  copyFormatterOption('hideLinkHrefIfSameAsText', 'anchor', 'hideLinkHrefIfSameAsText');\n  copyFormatterOption('ignoreHref', 'anchor', 'ignoreHref');\n  copyFormatterOption('linkHrefBaseUrl', 'anchor', 'baseUrl');\n  copyFormatterOption('noAnchorUrl', 'anchor', 'noAnchorUrl');\n  copyFormatterOption('noLinkBrackets', 'anchor', 'noLinkBrackets');\n  copyFormatterOption('linkHrefBaseUrl', 'image', 'baseUrl');\n  copyFormatterOption('unorderedListItemPrefix', 'unorderedList', 'itemPrefix');\n  copyFormatterOption('uppercaseHeadings', 'heading', 'uppercase');\n  copyFormatterOption('uppercaseHeadings', 'table', 'uppercaseHeadings');\n  copyFormatterOption('uppercaseHeadings', 'dataTable', 'uppercaseHeadings');\n\n  if (options['ignoreImage']) {\n    for (const definition of selectorDefinitions) {\n      if (definition.format === 'image') {\n        definition.format = 'skip';\n      }\n    }\n  }\n\n  if (options['singleNewLineParagraphs']) {\n    for (const definition of selectorDefinitions) {\n      if (definition.format === 'paragraph' || definition.format === 'pre') {\n        set(definition, ['options', 'leadingLineBreaks'], 1);\n        set(definition, ['options', 'trailingLineBreaks'], 1);\n      }\n    }\n  }\n\n  if (options['baseElement']) {\n    const baseElement = options['baseElement'];\n    set(options, ['baseElements', 'selectors'], Array.isArray(baseElement) ? baseElement : [baseElement]);\n  }\n\n  if (options['returnDomByDefault'] !== undefined) {\n    set(options, ['baseElements', 'returnDomByDefault'], options['returnDomByDefault']);\n  }\n}\n\nfunction findBases(dom, options, baseSelectorsPicker) {\n  const results = [];\n\n  function recursiveWalk(walk,\n  /** @type { DomNode[] } */\n  dom) {\n    dom = dom.slice(0, options.limits.maxChildNodes);\n\n    for (const elem of dom) {\n      if (elem.type !== 'tag') {\n        continue;\n      }\n\n      const pickedSelectorIndex = baseSelectorsPicker.pick1(elem);\n\n      if (pickedSelectorIndex > 0) {\n        results.push({\n          selectorIndex: pickedSelectorIndex,\n          element: elem\n        });\n      } else if (elem.children) {\n        walk(elem.children);\n      }\n\n      if (results.length >= options.limits.maxBaseElements) {\n        return;\n      }\n    }\n  }\n\n  const limitedWalk = limitedDepthRecursive(options.limits.maxDepth, recursiveWalk);\n  limitedWalk(dom);\n\n  if (options.baseElements.orderBy !== 'occurrence') {\n    // 'selectors'\n    results.sort((a, b) => a.selectorIndex - b.selectorIndex);\n  }\n\n  return options.baseElements.returnDomByDefault && results.length === 0 ? dom : results.map(x => x.element);\n}\n/**\n * Function to walk through DOM nodes and accumulate their string representations.\n *\n * @param   { RecursiveCallback } walk    Recursive callback.\n * @param   { DomNode[] }         [dom]   Nodes array to process.\n * @param   { BlockTextBuilder }  builder Passed around to accumulate output text.\n * @private\n */\n\n\nfunction recursiveWalk(walk, dom, builder) {\n  if (!dom) {\n    return;\n  }\n\n  const options = builder.options;\n  const tooManyChildNodes = dom.length > options.limits.maxChildNodes;\n\n  if (tooManyChildNodes) {\n    dom = dom.slice(0, options.limits.maxChildNodes);\n    dom.push({\n      data: options.limits.ellipsis,\n      type: 'text'\n    });\n  }\n\n  for (const elem of dom) {\n    switch (elem.type) {\n      case 'text':\n        {\n          builder.addInline(he.decode(elem.data, options.decodeOptions));\n          break;\n        }\n\n      case 'tag':\n        {\n          const tagDefinition = builder.picker.pick1(elem);\n          const format = options.formatters[tagDefinition.format];\n          format(elem, walk, builder, tagDefinition.options || {});\n          break;\n        }\n\n      default:\n        /* do nothing */\n        break;\n    }\n  }\n\n  return;\n}\n/**\n * @deprecated Use `{ convert }` function instead!\n * @see convert\n *\n * @param   { string }  html           HTML content to convert.\n * @param   { Options } [options = {}] HtmlToText options.\n * @returns { string }                 Plain text string.\n * @static\n */\n\n\nconst fromString = (html, options = {}) => convert(html, options);\n\nmodule.exports = {\n  compile: compile,\n  convert: convert,\n  fromString: fromString,\n  htmlToText: convert\n};","map":{"version":3,"sources":["C:/Users/m2bab/VM/rd2/frontend/node_modules/html-to-text/lib/html-to-text.js"],"names":["hp2Builder","require","merge","he","htmlparser","selderee","BlockTextBuilder","defaultFormatters","limitedDepthRecursive","mergeDuplicatesPreferLast","set","DEFAULT_OPTIONS","baseElements","selectors","orderBy","returnDomByDefault","decodeOptions","isAttributeValue","strict","formatters","limits","ellipsis","maxBaseElements","undefined","maxChildNodes","maxDepth","maxInputLength","longWordSplit","forceWrapOnLimit","wrapCharacters","preserveNewlines","selector","format","options","baseUrl","hideLinkHrefIfSameAsText","ignoreHref","noAnchorUrl","noLinkBrackets","leadingLineBreaks","trailingLineBreaks","trimEmptyLines","uppercase","length","colSpacing","maxColumnWidth","rowSpacing","uppercaseHeaderCells","itemPrefix","tables","whitespaceCharacters","wordwrap","concatMerge","acc","src","overwriteMerge","selectorsMerge","some","s","compile","arrayMerge","customMerge","key","Object","assign","handleDeprecatedOptions","uniqueSelectors","selectorsWithoutFormat","filter","Error","map","join","picker","DecisionTree","build","baseSelectorsPicker","i","findBaseElements","dom","findBases","limitedWalk","recursiveWalk","builder","addInline","html","process","walk","console","warn","substring","handler","DomHandler","Parser","decodeEntities","parseComplete","bases","toString","convert","selectorDefinitions","tags","tagDefinitions","entries","definition","push","copyFormatterOption","source","target","baseElement","Array","isArray","results","slice","elem","type","pickedSelectorIndex","pick1","selectorIndex","element","children","sort","a","b","x","tooManyChildNodes","data","decode","tagDefinition","fromString","module","exports","htmlToText"],"mappings":"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","sourcesContent":["const { hp2Builder } = require('@selderee/plugin-htmlparser2');\nconst merge = require('deepmerge');\nconst he = require('he');\nconst htmlparser = require('htmlparser2');\nconst selderee = require('selderee');\n\nconst { BlockTextBuilder } = require('./block-text-builder');\nconst defaultFormatters = require('./formatter');\nconst { limitedDepthRecursive, mergeDuplicatesPreferLast, set } = require('./helper');\n\n// eslint-disable-next-line import/no-unassigned-import\nrequire('./typedefs');\n\n\n/**\n * Default options.\n *\n * @constant\n * @type { Options }\n * @default\n * @private\n */\nconst DEFAULT_OPTIONS = {\n  baseElements: {\n    selectors: [ 'body' ],\n    orderBy: 'selectors', // 'selectors' | 'occurrence'\n    returnDomByDefault: true\n  },\n  decodeOptions: {\n    isAttributeValue: false,\n    strict: false\n  },\n  formatters: {},\n  limits: {\n    ellipsis: '...',\n    maxBaseElements: undefined,\n    maxChildNodes: undefined,\n    maxDepth: undefined,\n    maxInputLength: (1 << 24) // 16_777_216\n  },\n  longWordSplit: {\n    forceWrapOnLimit: false,\n    wrapCharacters: []\n  },\n  preserveNewlines: false,\n  selectors: [\n    { selector: '*', format: 'inline' },\n    {\n      selector: 'a',\n      format: 'anchor',\n      options: {\n        baseUrl: null,\n        hideLinkHrefIfSameAsText: false,\n        ignoreHref: false,\n        noAnchorUrl: true,\n        noLinkBrackets: false\n      }\n    },\n    { selector: 'article', format: 'block' },\n    { selector: 'aside', format: 'block' },\n    {\n      selector: 'blockquote',\n      format: 'blockquote',\n      options: { leadingLineBreaks: 2, trailingLineBreaks: 2, trimEmptyLines: true }\n    },\n    { selector: 'br', format: 'lineBreak' },\n    { selector: 'div', format: 'block' },\n    { selector: 'footer', format: 'block' },\n    { selector: 'form', format: 'block' },\n    { selector: 'h1', format: 'heading', options: { leadingLineBreaks: 3, trailingLineBreaks: 2, uppercase: true } },\n    { selector: 'h2', format: 'heading', options: { leadingLineBreaks: 3, trailingLineBreaks: 2, uppercase: true } },\n    { selector: 'h3', format: 'heading', options: { leadingLineBreaks: 3, trailingLineBreaks: 2, uppercase: true } },\n    { selector: 'h4', format: 'heading', options: { leadingLineBreaks: 2, trailingLineBreaks: 2, uppercase: true } },\n    { selector: 'h5', format: 'heading', options: { leadingLineBreaks: 2, trailingLineBreaks: 2, uppercase: true } },\n    { selector: 'h6', format: 'heading', options: { leadingLineBreaks: 2, trailingLineBreaks: 2, uppercase: true } },\n    { selector: 'header', format: 'block' },\n    {\n      selector: 'hr',\n      format: 'horizontalLine',\n      options: { leadingLineBreaks: 2, length: undefined, trailingLineBreaks: 2 }\n    },\n    { selector: 'img', format: 'image', options: { baseUrl: null } },\n    { selector: 'main', format: 'block' },\n    { selector: 'nav', format: 'block' },\n    {\n      selector: 'ol',\n      format: 'orderedList',\n      options: { leadingLineBreaks: 2, trailingLineBreaks: 2 }\n    },\n    { selector: 'p', format: 'paragraph', options: { leadingLineBreaks: 2, trailingLineBreaks: 2 } },\n    { selector: 'pre', format: 'pre', options: { leadingLineBreaks: 2, trailingLineBreaks: 2 } },\n    { selector: 'section', format: 'block' },\n    {\n      selector: 'table',\n      format: 'table',\n      options: {\n        colSpacing: 3,\n        leadingLineBreaks: 2,\n        maxColumnWidth: 60,\n        rowSpacing: 0,\n        trailingLineBreaks: 2,\n        uppercaseHeaderCells: true\n      }\n    },\n    {\n      selector: 'ul',\n      format: 'unorderedList',\n      options: { itemPrefix: ' * ', leadingLineBreaks: 2, trailingLineBreaks: 2 }\n    },\n    { selector: 'wbr', format: 'wbr' },\n  ],\n  tables: [], // deprecated\n  whitespaceCharacters: ' \\t\\r\\n\\f\\u200b',\n  wordwrap: 80\n};\n\nconst concatMerge = (acc, src, options) => [...acc, ...src];\nconst overwriteMerge = (acc, src, options) => [...src];\nconst selectorsMerge = (acc, src, options) => (\n  (acc.some(s => typeof s === 'object'))\n    ? concatMerge(acc, src, options) // selectors\n    : overwriteMerge(acc, src, options) // baseElements.selectors\n);\n\n/**\n * Preprocess options, compile selectors into a decision tree,\n * return a function intended for batch processing.\n *\n * @param   { Options } [options = {}]   HtmlToText options.\n * @returns { (html: string) => string } Pre-configured converter function.\n * @static\n */\nfunction compile (options = {}) {\n  options = merge(\n    DEFAULT_OPTIONS,\n    options,\n    {\n      arrayMerge: overwriteMerge,\n      customMerge: (key) => ((key === 'selectors') ? selectorsMerge : undefined)\n    }\n  );\n  options.formatters = Object.assign({}, defaultFormatters, options.formatters);\n\n  handleDeprecatedOptions(options);\n\n  const uniqueSelectors = mergeDuplicatesPreferLast(options.selectors, (s => s.selector));\n  const selectorsWithoutFormat = uniqueSelectors.filter(s => !s.format);\n  if (selectorsWithoutFormat.length) {\n    throw new Error(\n      'Following selectors have no specified format: ' +\n      selectorsWithoutFormat.map(s => `\\`${s.selector}\\``).join(', ')\n    );\n  }\n  const picker = new selderee.DecisionTree(\n    uniqueSelectors.map(s => [s.selector, s])\n  ).build(hp2Builder);\n\n  const baseSelectorsPicker = new selderee.DecisionTree(\n    options.baseElements.selectors.map((s, i) => [s, i + 1])\n  ).build(hp2Builder);\n  function findBaseElements (dom) {\n    return findBases(dom, options, baseSelectorsPicker);\n  }\n\n  const limitedWalk = limitedDepthRecursive(\n    options.limits.maxDepth,\n    recursiveWalk,\n    function (dom, builder) {\n      builder.addInline(options.limits.ellipsis || '');\n    }\n  );\n\n  return function (html) {\n    return process(html, options, picker, findBaseElements, limitedWalk);\n  };\n}\n\n/**\n * Convert given HTML according to preprocessed options.\n *\n * @param { string } html HTML content to convert.\n * @param { Options } options HtmlToText options (preprocessed).\n * @param { Picker<DomNode, TagDefinition> } picker\n * Tag definition picker for DOM nodes processing.\n * @param { (dom: DomNode[]) => DomNode[] } findBaseElements\n * Function to extract elements from HTML DOM\n * that will only be present in the output text.\n * @param { RecursiveCallback } walk Recursive callback.\n * @returns { string }\n */\nfunction process (html, options, picker, findBaseElements, walk) {\n  const maxInputLength = options.limits.maxInputLength;\n  if (maxInputLength && html && html.length > maxInputLength) {\n    console.warn(\n      `Input length ${html.length} is above allowed limit of ${maxInputLength}. Truncating without ellipsis.`\n    );\n    html = html.substring(0, maxInputLength);\n  }\n\n  const handler = new htmlparser.DomHandler();\n  new htmlparser.Parser(handler, { decodeEntities: false }).parseComplete(html);\n\n  const bases = findBaseElements(handler.dom);\n  const builder = new BlockTextBuilder(options, picker);\n  walk(bases, builder);\n  return builder.toString();\n}\n\n/**\n * Convert given HTML content to plain text string.\n *\n * @param   { string }  html           HTML content to convert.\n * @param   { Options } [options = {}] HtmlToText options.\n * @returns { string }                 Plain text string.\n * @static\n *\n * @example\n * const { convert } = require('html-to-text');\n * const text = convert('<h1>Hello World</h1>', {\n *   wordwrap: 130\n * });\n * console.log(text); // HELLO WORLD\n */\nfunction convert (html, options = {}) {\n  return compile(options)(html);\n}\n\n/**\n * Map previously existing and now deprecated options to the new options layout.\n * This is a subject for cleanup in major releases.\n *\n * @param { Options } options HtmlToText options.\n */\nfunction handleDeprecatedOptions (options) {\n  const selectorDefinitions = options.selectors;\n\n  if (options.tags) {\n    const tagDefinitions = Object.entries(options.tags).map(\n      ([selector, definition]) => ({ ...definition, selector: selector || '*' })\n    );\n    selectorDefinitions.push(...tagDefinitions);\n  }\n\n  function copyFormatterOption (source, format, target) {\n    if (options[source] === undefined) { return; }\n    for (const definition of selectorDefinitions) {\n      if (definition.format === format) {\n        set(definition, ['options', target], options[source]);\n      }\n    }\n  }\n\n  copyFormatterOption('hideLinkHrefIfSameAsText', 'anchor', 'hideLinkHrefIfSameAsText');\n  copyFormatterOption('ignoreHref', 'anchor', 'ignoreHref');\n  copyFormatterOption('linkHrefBaseUrl', 'anchor', 'baseUrl');\n  copyFormatterOption('noAnchorUrl', 'anchor', 'noAnchorUrl');\n  copyFormatterOption('noLinkBrackets', 'anchor', 'noLinkBrackets');\n\n  copyFormatterOption('linkHrefBaseUrl', 'image', 'baseUrl');\n\n  copyFormatterOption('unorderedListItemPrefix', 'unorderedList', 'itemPrefix');\n\n  copyFormatterOption('uppercaseHeadings', 'heading', 'uppercase');\n  copyFormatterOption('uppercaseHeadings', 'table', 'uppercaseHeadings');\n  copyFormatterOption('uppercaseHeadings', 'dataTable', 'uppercaseHeadings');\n\n  if (options['ignoreImage']) {\n    for (const definition of selectorDefinitions) {\n      if (definition.format === 'image') {\n        definition.format = 'skip';\n      }\n    }\n  }\n\n  if (options['singleNewLineParagraphs']) {\n    for (const definition of selectorDefinitions) {\n      if (definition.format === 'paragraph' || definition.format === 'pre') {\n        set(definition, ['options', 'leadingLineBreaks'], 1);\n        set(definition, ['options', 'trailingLineBreaks'], 1);\n      }\n    }\n  }\n\n  if (options['baseElement']) {\n    const baseElement = options['baseElement'];\n    set(\n      options,\n      ['baseElements', 'selectors'],\n      (Array.isArray(baseElement) ? baseElement : [baseElement])\n    );\n  }\n  if (options['returnDomByDefault'] !== undefined) {\n    set(options, ['baseElements', 'returnDomByDefault'], options['returnDomByDefault']);\n  }\n}\n\nfunction findBases (dom, options, baseSelectorsPicker) {\n  const results = [];\n\n  function recursiveWalk (walk, /** @type { DomNode[] } */ dom) {\n    dom = dom.slice(0, options.limits.maxChildNodes);\n    for (const elem of dom) {\n      if (elem.type !== 'tag') {\n        continue;\n      }\n      const pickedSelectorIndex = baseSelectorsPicker.pick1(elem);\n      if (pickedSelectorIndex > 0) {\n        results.push({ selectorIndex: pickedSelectorIndex, element: elem });\n      } else if (elem.children) {\n        walk(elem.children);\n      }\n      if (results.length >= options.limits.maxBaseElements) {\n        return;\n      }\n    }\n  }\n\n  const limitedWalk = limitedDepthRecursive(\n    options.limits.maxDepth,\n    recursiveWalk\n  );\n  limitedWalk(dom);\n\n  if (options.baseElements.orderBy !== 'occurrence') { // 'selectors'\n    results.sort((a, b) => a.selectorIndex - b.selectorIndex);\n  }\n  return (options.baseElements.returnDomByDefault && results.length === 0)\n    ? dom\n    : results.map(x => x.element);\n}\n\n/**\n * Function to walk through DOM nodes and accumulate their string representations.\n *\n * @param   { RecursiveCallback } walk    Recursive callback.\n * @param   { DomNode[] }         [dom]   Nodes array to process.\n * @param   { BlockTextBuilder }  builder Passed around to accumulate output text.\n * @private\n */\nfunction recursiveWalk (walk, dom, builder) {\n  if (!dom) { return; }\n\n  const options = builder.options;\n\n  const tooManyChildNodes = dom.length > options.limits.maxChildNodes;\n  if (tooManyChildNodes) {\n    dom = dom.slice(0, options.limits.maxChildNodes);\n    dom.push({\n      data: options.limits.ellipsis,\n      type: 'text'\n    });\n  }\n\n  for (const elem of dom) {\n    switch (elem.type) {\n      case 'text': {\n        builder.addInline(he.decode(elem.data, options.decodeOptions));\n        break;\n      }\n      case 'tag': {\n        const tagDefinition = builder.picker.pick1(elem);\n        const format = options.formatters[tagDefinition.format];\n        format(elem, walk, builder, tagDefinition.options || {});\n        break;\n      }\n      default:\n        /* do nothing */\n        break;\n    }\n  }\n\n  return;\n}\n\n/**\n * @deprecated Use `{ convert }` function instead!\n * @see convert\n *\n * @param   { string }  html           HTML content to convert.\n * @param   { Options } [options = {}] HtmlToText options.\n * @returns { string }                 Plain text string.\n * @static\n */\nconst fromString = (html, options = {}) => convert(html, options);\n\nmodule.exports = {\n  compile: compile,\n  convert: convert,\n  fromString: fromString,\n  htmlToText: convert\n};\n"]},"metadata":{},"sourceType":"script"}