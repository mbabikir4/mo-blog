{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ReferenceManyField = undefined;\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _reactRedux = require('react-redux');\n\nvar _LinearProgress = require('material-ui/LinearProgress');\n\nvar _LinearProgress2 = _interopRequireDefault(_LinearProgress);\n\nvar _dataActions = require('../../actions/dataActions');\n\nvar _oneToMany = require('../../reducer/admin/references/oneToMany');\n\nvar _queryReducer = require('../../reducer/admin/resource/list/queryReducer');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n * Render related records to the current one.\n *\n * You must define the fields to be passed to the iterator component as children.\n *\n * @example Display all the comments of the current post as a datagrid\n * <ReferenceManyField reference=\"comments\" target=\"post_id\">\n *     <Datagrid>\n *         <TextField source=\"id\" />\n *         <TextField source=\"body\" />\n *         <DateField source=\"created_at\" />\n *         <EditButton />\n *     </Datagrid>\n * </ReferenceManyField>\n *\n * @example Display all the books by the current author, only the title\n * <ReferenceManyField reference=\"books\" target=\"author_id\">\n *     <SingleFieldList>\n *         <ChipField source=\"title\" />\n *     </SingleFieldList>\n * </ReferenceManyField>\n *\n * By default, restricts the possible values to 25. You can extend this limit\n * by setting the `perPage` prop.\n *\n * @example\n * <ReferenceManyField perPage={10} reference=\"comments\" target=\"post_id\">\n *    ...\n * </ReferenceManyField>\n *\n * By default, orders the possible values by id desc. You can change this order\n * by setting the `sort` prop (an object with `field` and `order` properties).\n *\n * @example\n * <ReferenceManyField sort={{ field: 'created_at', order: 'DESC' }} reference=\"comments\" target=\"post_id\">\n *    ...\n * </ReferenceManyField>\n *\n * Also, you can filter the query used to populate the possible values. Use the\n * `filter` prop for that.\n *\n * @example\n * <ReferenceManyField filter={{ is_published: true }} reference=\"comments\" target=\"post_id\">\n *    ...\n * </ReferenceManyField>\n */\n\n\nvar ReferenceManyField = exports.ReferenceManyField = function (_Component) {\n  (0, _inherits3.default)(ReferenceManyField, _Component);\n\n  function ReferenceManyField(props) {\n    (0, _classCallCheck3.default)(this, ReferenceManyField);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (ReferenceManyField.__proto__ || Object.getPrototypeOf(ReferenceManyField)).call(this, props));\n\n    _this.setSort = function (field) {\n      var order = _this.state.sort.field === field && _this.state.sort.order === _queryReducer.SORT_ASC ? _queryReducer.SORT_DESC : _queryReducer.SORT_ASC;\n\n      _this.setState({\n        sort: {\n          field: field,\n          order: order\n        }\n      }, _this.fetchReferences);\n    };\n\n    _this.state = {\n      sort: props.sort\n    };\n    return _this;\n  }\n\n  (0, _createClass3.default)(ReferenceManyField, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.fetchReferences();\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.props.record.id !== nextProps.record.id) {\n        this.fetchReferences(nextProps);\n      }\n    }\n  }, {\n    key: 'fetchReferences',\n    value: function fetchReferences() {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.props,\n          reference = _ref.reference,\n          record = _ref.record,\n          resource = _ref.resource,\n          target = _ref.target,\n          perPage = _ref.perPage,\n          filter = _ref.filter;\n\n      var crudGetManyReference = this.props.crudGetManyReference;\n      var pagination = {\n        page: 1,\n        perPage: perPage\n      };\n      var relatedTo = (0, _oneToMany.nameRelatedTo)(reference, record.id, resource, target, filter);\n      crudGetManyReference(reference, target, record.id, relatedTo, pagination, this.state.sort, filter);\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          resource = _props.resource,\n          reference = _props.reference,\n          data = _props.data,\n          ids = _props.ids,\n          children = _props.children,\n          basePath = _props.basePath,\n          isLoading = _props.isLoading;\n\n      if (_react2.default.Children.count(children) !== 1) {\n        throw new Error('<ReferenceManyField> only accepts a single child (like <Datagrid>)');\n      }\n\n      if (typeof ids === 'undefined') {\n        return _react2.default.createElement(_LinearProgress2.default, {\n          style: {\n            marginTop: '1em'\n          }\n        });\n      }\n\n      var referenceBasePath = basePath.replace(resource, reference); // FIXME obviously very weak\n\n      return _react2.default.cloneElement(children, {\n        resource: reference,\n        ids: ids,\n        data: data,\n        isLoading: isLoading,\n        basePath: referenceBasePath,\n        currentSort: this.state.sort,\n        setSort: this.setSort\n      });\n    }\n  }]);\n  return ReferenceManyField;\n}(_react.Component);\n\nReferenceManyField.propTypes = {\n  addLabel: _propTypes2.default.bool,\n  basePath: _propTypes2.default.string.isRequired,\n  children: _propTypes2.default.element.isRequired,\n  crudGetManyReference: _propTypes2.default.func.isRequired,\n  filter: _propTypes2.default.object,\n  ids: _propTypes2.default.array,\n  label: _propTypes2.default.string,\n  perPage: _propTypes2.default.number,\n  record: _propTypes2.default.object,\n  reference: _propTypes2.default.string.isRequired,\n  data: _propTypes2.default.object,\n  resource: _propTypes2.default.string.isRequired,\n  sort: _propTypes2.default.shape({\n    field: _propTypes2.default.string,\n    order: _propTypes2.default.oneOf(['ASC', 'DESC'])\n  }),\n  source: _propTypes2.default.string.isRequired,\n  target: _propTypes2.default.string.isRequired,\n  isLoading: _propTypes2.default.bool\n};\nReferenceManyField.defaultProps = {\n  filter: {},\n  perPage: 25,\n  sort: {\n    field: 'id',\n    order: 'DESC'\n  },\n  source: ''\n};\n\nfunction mapStateToProps(state, props) {\n  var relatedTo = (0, _oneToMany.nameRelatedTo)(props.reference, props.record.id, props.resource, props.target, props.filter);\n  return {\n    data: (0, _oneToMany.getReferences)(state, props.reference, relatedTo),\n    ids: (0, _oneToMany.getIds)(state, relatedTo),\n    isLoading: state.admin.loading > 0\n  };\n}\n\nvar ConnectedReferenceManyField = (0, _reactRedux.connect)(mapStateToProps, {\n  crudGetManyReference: _dataActions.crudGetManyReference\n})(ReferenceManyField);\nConnectedReferenceManyField.defaultProps = {\n  addLabel: true,\n  source: ''\n};\nexports.default = ConnectedReferenceManyField;","map":{"version":3,"sources":["C:/Users/m2bab/VM/rd2/frontend/node_modules/admin-on-rest/lib/mui/field/ReferenceManyField.js"],"names":["Object","defineProperty","exports","value","ReferenceManyField","undefined","_classCallCheck2","require","_classCallCheck3","_interopRequireDefault","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_react","_react2","_propTypes","_propTypes2","_reactRedux","_LinearProgress","_LinearProgress2","_dataActions","_oneToMany","_queryReducer","obj","__esModule","default","_Component","props","_this","__proto__","getPrototypeOf","call","setSort","field","order","state","sort","SORT_ASC","SORT_DESC","setState","fetchReferences","key","componentDidMount","componentWillReceiveProps","nextProps","record","id","_ref","arguments","length","reference","resource","target","perPage","filter","crudGetManyReference","pagination","page","relatedTo","nameRelatedTo","render","_props","data","ids","children","basePath","isLoading","Children","count","Error","createElement","style","marginTop","referenceBasePath","replace","cloneElement","currentSort","Component","propTypes","addLabel","bool","string","isRequired","element","func","object","array","label","number","shape","oneOf","source","defaultProps","mapStateToProps","getReferences","getIds","admin","loading","ConnectedReferenceManyField","connect"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.ReferenceManyField = undefined;\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _reactRedux = require('react-redux');\n\nvar _LinearProgress = require('material-ui/LinearProgress');\n\nvar _LinearProgress2 = _interopRequireDefault(_LinearProgress);\n\nvar _dataActions = require('../../actions/dataActions');\n\nvar _oneToMany = require('../../reducer/admin/references/oneToMany');\n\nvar _queryReducer = require('../../reducer/admin/resource/list/queryReducer');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Render related records to the current one.\n *\n * You must define the fields to be passed to the iterator component as children.\n *\n * @example Display all the comments of the current post as a datagrid\n * <ReferenceManyField reference=\"comments\" target=\"post_id\">\n *     <Datagrid>\n *         <TextField source=\"id\" />\n *         <TextField source=\"body\" />\n *         <DateField source=\"created_at\" />\n *         <EditButton />\n *     </Datagrid>\n * </ReferenceManyField>\n *\n * @example Display all the books by the current author, only the title\n * <ReferenceManyField reference=\"books\" target=\"author_id\">\n *     <SingleFieldList>\n *         <ChipField source=\"title\" />\n *     </SingleFieldList>\n * </ReferenceManyField>\n *\n * By default, restricts the possible values to 25. You can extend this limit\n * by setting the `perPage` prop.\n *\n * @example\n * <ReferenceManyField perPage={10} reference=\"comments\" target=\"post_id\">\n *    ...\n * </ReferenceManyField>\n *\n * By default, orders the possible values by id desc. You can change this order\n * by setting the `sort` prop (an object with `field` and `order` properties).\n *\n * @example\n * <ReferenceManyField sort={{ field: 'created_at', order: 'DESC' }} reference=\"comments\" target=\"post_id\">\n *    ...\n * </ReferenceManyField>\n *\n * Also, you can filter the query used to populate the possible values. Use the\n * `filter` prop for that.\n *\n * @example\n * <ReferenceManyField filter={{ is_published: true }} reference=\"comments\" target=\"post_id\">\n *    ...\n * </ReferenceManyField>\n */\nvar ReferenceManyField = exports.ReferenceManyField = function (_Component) {\n    (0, _inherits3.default)(ReferenceManyField, _Component);\n\n    function ReferenceManyField(props) {\n        (0, _classCallCheck3.default)(this, ReferenceManyField);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (ReferenceManyField.__proto__ || Object.getPrototypeOf(ReferenceManyField)).call(this, props));\n\n        _this.setSort = function (field) {\n            var order = _this.state.sort.field === field && _this.state.sort.order === _queryReducer.SORT_ASC ? _queryReducer.SORT_DESC : _queryReducer.SORT_ASC;\n            _this.setState({ sort: { field: field, order: order } }, _this.fetchReferences);\n        };\n\n        _this.state = { sort: props.sort };\n        return _this;\n    }\n\n    (0, _createClass3.default)(ReferenceManyField, [{\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            this.fetchReferences();\n        }\n    }, {\n        key: 'componentWillReceiveProps',\n        value: function componentWillReceiveProps(nextProps) {\n            if (this.props.record.id !== nextProps.record.id) {\n                this.fetchReferences(nextProps);\n            }\n        }\n    }, {\n        key: 'fetchReferences',\n        value: function fetchReferences() {\n            var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.props,\n                reference = _ref.reference,\n                record = _ref.record,\n                resource = _ref.resource,\n                target = _ref.target,\n                perPage = _ref.perPage,\n                filter = _ref.filter;\n\n            var crudGetManyReference = this.props.crudGetManyReference;\n\n            var pagination = { page: 1, perPage: perPage };\n            var relatedTo = (0, _oneToMany.nameRelatedTo)(reference, record.id, resource, target, filter);\n            crudGetManyReference(reference, target, record.id, relatedTo, pagination, this.state.sort, filter);\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _props = this.props,\n                resource = _props.resource,\n                reference = _props.reference,\n                data = _props.data,\n                ids = _props.ids,\n                children = _props.children,\n                basePath = _props.basePath,\n                isLoading = _props.isLoading;\n\n            if (_react2.default.Children.count(children) !== 1) {\n                throw new Error('<ReferenceManyField> only accepts a single child (like <Datagrid>)');\n            }\n            if (typeof ids === 'undefined') {\n                return _react2.default.createElement(_LinearProgress2.default, { style: { marginTop: '1em' } });\n            }\n            var referenceBasePath = basePath.replace(resource, reference); // FIXME obviously very weak\n            return _react2.default.cloneElement(children, {\n                resource: reference,\n                ids: ids,\n                data: data,\n                isLoading: isLoading,\n                basePath: referenceBasePath,\n                currentSort: this.state.sort,\n                setSort: this.setSort\n            });\n        }\n    }]);\n    return ReferenceManyField;\n}(_react.Component);\n\nReferenceManyField.propTypes = {\n    addLabel: _propTypes2.default.bool,\n    basePath: _propTypes2.default.string.isRequired,\n    children: _propTypes2.default.element.isRequired,\n    crudGetManyReference: _propTypes2.default.func.isRequired,\n    filter: _propTypes2.default.object,\n    ids: _propTypes2.default.array,\n    label: _propTypes2.default.string,\n    perPage: _propTypes2.default.number,\n    record: _propTypes2.default.object,\n    reference: _propTypes2.default.string.isRequired,\n    data: _propTypes2.default.object,\n    resource: _propTypes2.default.string.isRequired,\n    sort: _propTypes2.default.shape({\n        field: _propTypes2.default.string,\n        order: _propTypes2.default.oneOf(['ASC', 'DESC'])\n    }),\n    source: _propTypes2.default.string.isRequired,\n    target: _propTypes2.default.string.isRequired,\n    isLoading: _propTypes2.default.bool\n};\n\nReferenceManyField.defaultProps = {\n    filter: {},\n    perPage: 25,\n    sort: { field: 'id', order: 'DESC' },\n    source: ''\n};\n\nfunction mapStateToProps(state, props) {\n    var relatedTo = (0, _oneToMany.nameRelatedTo)(props.reference, props.record.id, props.resource, props.target, props.filter);\n    return {\n        data: (0, _oneToMany.getReferences)(state, props.reference, relatedTo),\n        ids: (0, _oneToMany.getIds)(state, relatedTo),\n        isLoading: state.admin.loading > 0\n    };\n}\n\nvar ConnectedReferenceManyField = (0, _reactRedux.connect)(mapStateToProps, {\n    crudGetManyReference: _dataActions.crudGetManyReference\n})(ReferenceManyField);\n\nConnectedReferenceManyField.defaultProps = {\n    addLabel: true,\n    source: ''\n};\n\nexports.default = ConnectedReferenceManyField;"]},"metadata":{},"sourceType":"script"}