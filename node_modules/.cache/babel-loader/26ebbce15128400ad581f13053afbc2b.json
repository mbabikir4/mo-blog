{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends3 = require('babel-runtime/helpers/extends');\n\nvar _extends4 = _interopRequireDefault(_extends3);\n\nvar _lodash = require('lodash.pickby');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar defaultCacheDuration = 10 * 60 * 1000; // ten minutes\n\nexports.default = function () {\n  var newRecordIds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var oldRecordFetchedAt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var now = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Date();\n  var cacheDuration = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : defaultCacheDuration; // prepare new records and timestamp them\n\n  var newFetchedAt = newRecordIds.reduce(function (prev, recordId) {\n    return (0, _extends4.default)({}, prev, (0, _defineProperty3.default)({}, recordId, now));\n  }, {}); // remove outdated entry\n\n  var latestValidDate = new Date();\n  latestValidDate.setTime(latestValidDate.getTime() - cacheDuration);\n  var stillValidFetchedAt = (0, _lodash2.default)(oldRecordFetchedAt, function (date) {\n    return date > latestValidDate;\n  });\n  return (0, _extends4.default)({}, stillValidFetchedAt, newFetchedAt);\n};\n\nmodule.exports = exports['default'];","map":{"version":3,"sources":["C:/Users/m2bab/VM/rd2/frontend/node_modules/admin-on-rest/lib/util/getFetchedAt.js"],"names":["Object","defineProperty","exports","value","_defineProperty2","require","_defineProperty3","_interopRequireDefault","_extends3","_extends4","_lodash","_lodash2","obj","__esModule","default","defaultCacheDuration","newRecordIds","arguments","length","undefined","oldRecordFetchedAt","now","Date","cacheDuration","newFetchedAt","reduce","prev","recordId","latestValidDate","setTime","getTime","stillValidFetchedAt","date","module"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AACzCC,EAAAA,KAAK,EAAE;AADkC,CAA7C;;AAIA,IAAIC,gBAAgB,GAAGC,OAAO,CAAC,sCAAD,CAA9B;;AAEA,IAAIC,gBAAgB,GAAGC,sBAAsB,CAACH,gBAAD,CAA7C;;AAEA,IAAII,SAAS,GAAGH,OAAO,CAAC,+BAAD,CAAvB;;AAEA,IAAII,SAAS,GAAGF,sBAAsB,CAACC,SAAD,CAAtC;;AAEA,IAAIE,OAAO,GAAGL,OAAO,CAAC,eAAD,CAArB;;AAEA,IAAIM,QAAQ,GAAGJ,sBAAsB,CAACG,OAAD,CAArC;;AAEA,SAASH,sBAAT,CAAgCK,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAEE,IAAAA,OAAO,EAAEF;AAAX,GAArC;AAAwD;;AAE/F,IAAIG,oBAAoB,GAAG,KAAK,EAAL,GAAU,IAArC,C,CAA2C;;AAE3Cb,OAAO,CAACY,OAAR,GAAkB,YAAY;AAC1B,MAAIE,YAAY,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAvF;AACA,MAAIG,kBAAkB,GAAGH,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAA7F;AACA,MAAII,GAAG,GAAGJ,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,IAAIK,IAAJ,EAA9E;AACA,MAAIC,aAAa,GAAGN,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoEF,oBAAxF,CAJ0B,CAM1B;;AACA,MAAIS,YAAY,GAAGR,YAAY,CAACS,MAAb,CAAoB,UAAUC,IAAV,EAAgBC,QAAhB,EAA0B;AAC7D,WAAO,CAAC,GAAGlB,SAAS,CAACK,OAAd,EAAuB,EAAvB,EAA2BY,IAA3B,EAAiC,CAAC,GAAGpB,gBAAgB,CAACQ,OAArB,EAA8B,EAA9B,EAAkCa,QAAlC,EAA4CN,GAA5C,CAAjC,CAAP;AACH,GAFkB,EAEhB,EAFgB,CAAnB,CAP0B,CAU1B;;AACA,MAAIO,eAAe,GAAG,IAAIN,IAAJ,EAAtB;AACAM,EAAAA,eAAe,CAACC,OAAhB,CAAwBD,eAAe,CAACE,OAAhB,KAA4BP,aAApD;AAEA,MAAIQ,mBAAmB,GAAG,CAAC,GAAGpB,QAAQ,CAACG,OAAb,EAAsBM,kBAAtB,EAA0C,UAAUY,IAAV,EAAgB;AAChF,WAAOA,IAAI,GAAGJ,eAAd;AACH,GAFyB,CAA1B;AAIA,SAAO,CAAC,GAAGnB,SAAS,CAACK,OAAd,EAAuB,EAAvB,EAA2BiB,mBAA3B,EAAgDP,YAAhD,CAAP;AACH,CAnBD;;AAqBAS,MAAM,CAAC/B,OAAP,GAAiBA,OAAO,CAAC,SAAD,CAAxB","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends3 = require('babel-runtime/helpers/extends');\n\nvar _extends4 = _interopRequireDefault(_extends3);\n\nvar _lodash = require('lodash.pickby');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar defaultCacheDuration = 10 * 60 * 1000; // ten minutes\n\nexports.default = function () {\n    var newRecordIds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var oldRecordFetchedAt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var now = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Date();\n    var cacheDuration = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : defaultCacheDuration;\n\n    // prepare new records and timestamp them\n    var newFetchedAt = newRecordIds.reduce(function (prev, recordId) {\n        return (0, _extends4.default)({}, prev, (0, _defineProperty3.default)({}, recordId, now));\n    }, {});\n    // remove outdated entry\n    var latestValidDate = new Date();\n    latestValidDate.setTime(latestValidDate.getTime() - cacheDuration);\n\n    var stillValidFetchedAt = (0, _lodash2.default)(oldRecordFetchedAt, function (date) {\n        return date > latestValidDate;\n    });\n\n    return (0, _extends4.default)({}, stillValidFetchedAt, newFetchedAt);\n};\n\nmodule.exports = exports['default'];"]},"metadata":{},"sourceType":"script"}