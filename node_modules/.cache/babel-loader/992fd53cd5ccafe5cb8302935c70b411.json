{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getIds = exports.addRecordIdsFactory = undefined;\n\nvar _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _lodash = require('lodash.uniq');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _dataActions = require('../../../../actions/dataActions');\n\nvar _getFetchedAt = require('../../../../util/getFetchedAt');\n\nvar _getFetchedAt2 = _interopRequireDefault(_getFetchedAt);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar addRecordIdsFactory = exports.addRecordIdsFactory = function addRecordIdsFactory(getFetchedAt) {\n  return function () {\n    var newRecordIds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var oldRecordIds = arguments[1];\n    var newFetchedAt = getFetchedAt(newRecordIds, oldRecordIds.fetchedAt);\n    var recordIds = (0, _lodash2.default)(oldRecordIds.filter(function (id) {\n      return !!newFetchedAt[id];\n    }).concat(newRecordIds));\n    Object.defineProperty(recordIds, 'fetchedAt', {\n      value: newFetchedAt\n    }); // non enumerable by default\n\n    return recordIds;\n  };\n};\n\nvar addRecordIds = addRecordIdsFactory(_getFetchedAt2.default);\n\nexports.default = function (resource) {\n  return function () {\n    var previousState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var _ref = arguments[1];\n    var type = _ref.type,\n        payload = _ref.payload,\n        requestPayload = _ref.requestPayload,\n        meta = _ref.meta;\n\n    if (!meta || meta.resource !== resource) {\n      return previousState;\n    }\n\n    switch (type) {\n      case _dataActions.CRUD_GET_LIST_SUCCESS:\n        return addRecordIds(payload.data.map(function (_ref2) {\n          var id = _ref2.id;\n          return id;\n        }), []);\n\n      case _dataActions.CRUD_GET_MANY_SUCCESS:\n      case _dataActions.CRUD_GET_MANY_REFERENCE_SUCCESS:\n        return addRecordIds(payload.data.map(function (_ref3) {\n          var id = _ref3.id;\n          return id;\n        }).filter(function (id) {\n          return previousState.indexOf(id) !== -1;\n        }), previousState);\n\n      case _dataActions.CRUD_GET_ONE_SUCCESS:\n      case _dataActions.CRUD_CREATE_SUCCESS:\n      case _dataActions.CRUD_UPDATE_SUCCESS:\n        return addRecordIds([payload.data.id], previousState);\n\n      case _dataActions.CRUD_DELETE_SUCCESS:\n        {\n          var index = previousState.map(function (el) {\n            return el == requestPayload.id;\n          }) // eslint-disable-line eqeqeq\n          .indexOf(true);\n\n          if (index === -1) {\n            return previousState;\n          }\n\n          var newState = [].concat((0, _toConsumableArray3.default)(previousState.slice(0, index)), (0, _toConsumableArray3.default)(previousState.slice(index + 1)));\n          Object.defineProperty(newState, 'fetchedAt', previousState.fetchedAt);\n          return newState;\n        }\n\n      default:\n        return previousState;\n    }\n  };\n};\n\nvar getIds = exports.getIds = function getIds(state) {\n  return state;\n};","map":{"version":3,"sources":["C:/Users/m2bab/VM/rd2/frontend/node_modules/admin-on-rest/lib/reducer/admin/resource/list/ids.js"],"names":["Object","defineProperty","exports","value","getIds","addRecordIdsFactory","undefined","_toConsumableArray2","require","_toConsumableArray3","_interopRequireDefault","_lodash","_lodash2","_dataActions","_getFetchedAt","_getFetchedAt2","obj","__esModule","default","getFetchedAt","newRecordIds","arguments","length","oldRecordIds","newFetchedAt","fetchedAt","recordIds","filter","id","concat","addRecordIds","resource","previousState","_ref","type","payload","requestPayload","meta","CRUD_GET_LIST_SUCCESS","data","map","_ref2","CRUD_GET_MANY_SUCCESS","CRUD_GET_MANY_REFERENCE_SUCCESS","_ref3","indexOf","CRUD_GET_ONE_SUCCESS","CRUD_CREATE_SUCCESS","CRUD_UPDATE_SUCCESS","CRUD_DELETE_SUCCESS","index","el","newState","slice","state"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.getIds = exports.addRecordIdsFactory = undefined;\n\nvar _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _lodash = require('lodash.uniq');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _dataActions = require('../../../../actions/dataActions');\n\nvar _getFetchedAt = require('../../../../util/getFetchedAt');\n\nvar _getFetchedAt2 = _interopRequireDefault(_getFetchedAt);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar addRecordIdsFactory = exports.addRecordIdsFactory = function addRecordIdsFactory(getFetchedAt) {\n    return function () {\n        var newRecordIds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        var oldRecordIds = arguments[1];\n\n        var newFetchedAt = getFetchedAt(newRecordIds, oldRecordIds.fetchedAt);\n        var recordIds = (0, _lodash2.default)(oldRecordIds.filter(function (id) {\n            return !!newFetchedAt[id];\n        }).concat(newRecordIds));\n\n        Object.defineProperty(recordIds, 'fetchedAt', {\n            value: newFetchedAt\n        }); // non enumerable by default\n        return recordIds;\n    };\n};\n\nvar addRecordIds = addRecordIdsFactory(_getFetchedAt2.default);\n\nexports.default = function (resource) {\n    return function () {\n        var previousState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        var _ref = arguments[1];\n        var type = _ref.type,\n            payload = _ref.payload,\n            requestPayload = _ref.requestPayload,\n            meta = _ref.meta;\n\n        if (!meta || meta.resource !== resource) {\n            return previousState;\n        }\n        switch (type) {\n            case _dataActions.CRUD_GET_LIST_SUCCESS:\n                return addRecordIds(payload.data.map(function (_ref2) {\n                    var id = _ref2.id;\n                    return id;\n                }), []);\n            case _dataActions.CRUD_GET_MANY_SUCCESS:\n            case _dataActions.CRUD_GET_MANY_REFERENCE_SUCCESS:\n                return addRecordIds(payload.data.map(function (_ref3) {\n                    var id = _ref3.id;\n                    return id;\n                }).filter(function (id) {\n                    return previousState.indexOf(id) !== -1;\n                }), previousState);\n            case _dataActions.CRUD_GET_ONE_SUCCESS:\n            case _dataActions.CRUD_CREATE_SUCCESS:\n            case _dataActions.CRUD_UPDATE_SUCCESS:\n                return addRecordIds([payload.data.id], previousState);\n            case _dataActions.CRUD_DELETE_SUCCESS:\n                {\n                    var index = previousState.map(function (el) {\n                        return el == requestPayload.id;\n                    }) // eslint-disable-line eqeqeq\n                    .indexOf(true);\n                    if (index === -1) {\n                        return previousState;\n                    }\n                    var newState = [].concat((0, _toConsumableArray3.default)(previousState.slice(0, index)), (0, _toConsumableArray3.default)(previousState.slice(index + 1)));\n\n                    Object.defineProperty(newState, 'fetchedAt', previousState.fetchedAt);\n\n                    return newState;\n                }\n            default:\n                return previousState;\n        }\n    };\n};\n\nvar getIds = exports.getIds = function getIds(state) {\n    return state;\n};"]},"metadata":{},"sourceType":"script"}